# Repository Guidelines

## Project Structure & Module Organization

- `src/server` houses the Apps Script entry points. Expose functions through `src/server/index.ts` and keep helper utilities in `src/server/lib/`.
- `src/client` contains the Vite bundle; `src/client/main.ts` bootstraps the UI and imports shared modules.
- `src/shared` collects logic reused on both sides (e.g., validation or constants) to avoid duplicated code.
- `appsscript.json` tracks deployment settings; edit only the human-readable fields such as `timeZone` or `exceptionLogging`.
- `public/` stores static assets copied verbatim into the final deployment bundle.

## Build, Test, and Development Commands

- `npm install` initializes dependencies and prepares clasp for Apps Script sync.
- `npm run dev` / `npm run dev:open` starts the Vite dev server for local development with mock data.
- `npm run setup` ensures `.clasp.json` has `rootDir: "dist"` configured (runs automatically before build).
- `npm run build` emits production bundles to `dist/`.
- `npm run staging` / `npm run staging:open` builds and pushes to staging (@HEAD) environment.
- `npm run prod` / `npm run prod:open` builds, pushes, and updates the single production (versioned) deployment.
- `npm run prod:new` recreates production deployment from scratch (deletes existing and creates new).
- `npm run deployments` lists all active deployments.

## Coding Style & Naming Conventions

- TypeScript is linted by ESLint and formatted by Prettier (2-space indent, single quotes, trailing commas). Use `npm run lint -- --fix` to auto-correct.
- Export Google-exposed functions in PascalCase to map cleanly onto Apps Script menus; keep internal helpers camelCase.
- Name React/Svelte/Vue components in PascalCase and place them inside `src/client/components/`.
- Keep environment variables in `.env.local`, prefixed with `VITE_` (e.g., `VITE_API_BASE_URL=https://...`).

## Testing Guidelines

- Co-locate unit tests as `*.test.ts` beside the source or within `tests/` when shared fixtures are needed.
- Run `npm run test -- --coverage` and target â‰¥80% statements; document gaps in the PR if coverage dips.
- Use the stubs in `tests/mocks/appsScript.ts` when code touches Apps Script globals like `SpreadsheetApp`.

## Commit & Pull Request Guidelines

- Follow Conventional Commits (`feat:`, `fix:`, `chore:`) to keep the changelog script-friendly.
- PRs must summarize behaviour changes, reference related issues, and list manual verification steps (e.g., `npm run push` to staging).
- Attach screenshots or GIFs for UI updates and include the clasp deployment ID when relevant.

## Deployment & Access

- The `scriptId` in `.clasp.json` is auto-generated by `clasp create-script` or `clasp clone-script`; never commit alternate IDs for personal sandboxes.
- The `rootDir: "dist"` setting is automatically configured by the `setup` script to ensure clasp pushes from the correct directory.
- Three deployment environments:
  - **Development (local)**: `npm run dev:open` - Local Vite server with mock data
  - **Staging (@HEAD)**: `npm run staging:open` - Quick testing with real backend (`.../dev` URL)
  - **Production (versioned)**: `npm run prod:open` - Stable releases for end users (`.../exec` URL)
- Use `npm run staging` to push to @HEAD for quick testing without creating versions.
- Use `npm run prod` for production releases; it updates the single production deployment.
- **Constraint**: Only one production deployment is maintained for simplicity.
- Use `npm run prod:new` to recreate production deployment from scratch.
- Use `npm run deployments` to view all deployment IDs and URLs.
